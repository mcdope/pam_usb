# Created by: Pekka Helenius <fincer89 [at] hotmail [dot] com>

pkgname=pam_usb
pkgver=498.0.8.2_3f33636
pkgrel=1
pkgdesc='Hardware authentication for Linux using ordinary USB Flash Drives.'
arch=('x86_64')
url='https://github.com/mcdope/pam_usb'
license=('GPLv2')
depends=('pam' 'dbus' 'python' 'python-dbus' 'python-lxml' 'python-gobject' 'udisks2')
makedepends=('git' 'pkgconf' 'gcc' 'make' 'patch')
options=(!emptydirs)
backup=(
  "etc/security/pam_usb.conf"
)
source=(
  "pamusb.tar.gz"
  "pamusb-agent.service"
)
sha256sums=('SKIP'
            'f5875f0669b2638f36885c305d719072798b5097b15e6c94a8a852bb896bfc5c')

pkgver() {
  cd ..
  echo $(git rev-list --count HEAD).$(git for-each-ref --sort=creatordate --format '%(tag)' refs/tags | tail -n 1)_$(git rev-parse --short HEAD)
  cd $OLDPWD
}

package() {
  make DESTDIR=${pkgdir} PAM_USB_DEST=${pkgdir}/usr/lib/security install
  chmod 0700 ${pkgdir}/usr/bin/pamusb-agent
  install -Dt ${pkgdir}/usr/lib/systemd/system -m0644 ../pamusb-agent.service
}
